package cn.codingstyle.spider;

import cn.codingstyle.spider.application.CreateCrawlCommand;
import cn.codingstyle.spider.application.UpYunHelper;
import cn.codingstyle.spider.crawl.weixinmp.FileNameGenerator;
import cn.codingstyle.spider.domain.CrawlRecordDetail;
import cn.codingstyle.spider.domain.CrawlRecordDetailRepository;
import cn.codingstyle.web.rest.TestUtil;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.http.MediaType;
import org.springframework.security.test.context.support.WithMockUser;
import org.springframework.test.web.servlet.MockMvc;

import static cn.codingstyle.spider.Await.await;
import static java.util.concurrent.TimeUnit.SECONDS;
import static org.assertj.core.api.Assertions.assertThat;
import static org.mockito.Mockito.when;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;

@SpringBootTest
@WithMockUser(value = "test")
@AutoConfigureMockMvc
class SpiderResourceIT {

    @Autowired
    MockMvc mockMvc;

    @MockBean
    UpYunHelper upYunHelper;

    @MockBean
    FileNameGenerator fileNameGenerator;

    @Autowired
    private CrawlRecordDetailRepository crawlRecordDetailRepository;

    @BeforeEach
    void setUp() {
        crawlRecordDetailRepository.deleteAll();
    }

    @Test
    void should_crawl_jianshu_platform_success() throws Exception {
        CreateCrawlCommand command = new CreateCrawlCommand();
        command.setUrls("https://www.jianshu.com/p/e1810fdf5d11");
        postAndWait(command);

        CrawlRecordDetail jianshuArticle = crawlRecordDetailRepository.findAll().get(0);
        assertThat(jianshuArticle.getAuthor()).isEqualTo("武可");
        assertThat(jianshuArticle.getSubject()).isEqualTo("改善参数过多的方法");
        assertThat(jianshuArticle.getContent()).isEqualTo(expectedJianshuContent());
    }

    @Test
    void should_crawl_weixinmp_platform_success() throws Exception {
        CreateCrawlCommand command = new CreateCrawlCommand();
        command.setUrls("https://mp.weixin.qq.com/s/NfJ_EafbZPyPLZEeHz0Dkw");
        when(fileNameGenerator.createFileName("png")).thenReturn("1.png");
        postAndWait(command);

        CrawlRecordDetail weixinMpArticle = crawlRecordDetailRepository.findAll().get(0);
        assertThat(weixinMpArticle.getAuthor()).isEqualTo("SSgeek");
        assertThat(weixinMpArticle.getSubject()).isEqualTo("Jenkins workflowLibs库的使(妙)用");
        assertThat(weixinMpArticle.getContent()).isEqualTo(expectedMpContent());
    }

    private void postAndWait(CreateCrawlCommand command) throws Exception {
        mockMvc.perform(post("/api/spider/crawl")
                .contentType(MediaType.APPLICATION_JSON)
                .content(TestUtil.convertObjectToJsonBytes(command))
        )
                .andExpect(status().isOk());

        await().atMost(1000, SECONDS)
                .until(() -> crawlRecordDetailRepository.findAll().size())
                .isEqualTo(1);
    }

    private String expectedMpContent() {
        return "<div class=\"rich_media_content \" id=\"js_content\" style=\"visibility: visible;\"> \n" +
                " <section data-tool=\"mdnice编辑器\" data-website=\"https://www.mdnice.com\" style=\"font-size: 16px;color: black;padding-right: 10px;padding-left: 10px;line-height: 1.6;letter-spacing: 0px;word-break: break-word;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">目录</p>\n" +
                "  <ul style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;\" class=\"list-paddingleft-2\">\n" +
                "   <li><p>1、重温概念</p></li>\n" +
                "   <li><p>2、需求引入</p></li>\n" +
                "   <li><p>3、开通workflowLibs</p></li>\n" +
                "   <ul style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;list-style-type: square;\" class=\"list-paddingleft-2\">\n" +
                "    <li><p>3.1 开通ssh端口</p></li>\n" +
                "    <li><p>3.2 配置密钥</p></li>\n" +
                "    <li><p>3.3 初始化克隆workflowLibs库</p></li>\n" +
                "    <li><p>3.4 配置使用workflowLibs库</p></li>\n" +
                "   </ul>\n" +
                "   <li><p>4、自定义使用workflowLibs库</p></li>\n" +
                "   <ul style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;list-style-type: square;\" class=\"list-paddingleft-2\">\n" +
                "    <li><p>4.1 方法定义</p></li>\n" +
                "    <li><p>4.2 插件配置</p></li>\n" +
                "    <li><p>4.3 使用</p></li>\n" +
                "   </ul>\n" +
                "   <li><p>5、总结</p></li>\n" +
                "  </ul>\n" +
                "  <blockquote data-tool=\"mdnice编辑器\" style=\"border-top: none;border-right: none;border-bottom: none;font-size: 0.9em;overflow: auto;border-left-color: rgba(0, 0, 0, 0.4);background: rgba(0, 0, 0, 0.05);color: rgb(106, 115, 125);padding: 10px 10px 10px 20px;margin-bottom: 20px;margin-top: 20px;\">\n" +
                "   <p style=\"font-size: 16px;padding-top: 8px;padding-bottom: 8px;color: black;line-height: 26px;\">本文采用更为大白话的形式进行记录，实际应用在生产环境超过半年，现在整理出来分享一下</p>\n" +
                "  </blockquote>\n" +
                "  <h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;\"><span style=\"display: none;\"></span>1、重温概念</h2>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">开篇介绍，要写的当然还是一些文字性内容，不管是官方原文或书籍描述，都要花心思去理解，然后顺便表达一下我自己的理解。</p>\n" +
                "  <ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;\" class=\"list-paddingleft-2\">\n" +
                "   <li>\n" +
                "    <section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">\n" +
                "     可信共享库和不可信共享库\n" +
                "    </section></li>\n" +
                "  </ul>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\"><code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>的共享库形式，分为可信共享库和不可信共享库两种。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">可信库可以调用/使用<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Java</code>中的任何方法、<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">API</code>、<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>插件、<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Groovy</code>语言等。由于可信库在它们可以调用和使用的内容方面具有如此广泛的优势，所以管理可在其中添加和更改代码的权限就非常重要了。因此对可信库进行更新应该需要适当级别的源码版本控制访问和验证。出于同样的原因，可能会造成任何损害的代码应该始终被包含在受监督的可信库中。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">不可信库代码是被调用和使用限制的代码，调用先前列出的方法类型不允许使用相同的自由度，而且它不能像可信代码那样访问更大的内部对象集合。</p>\n" +
                "  <ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;\" class=\"list-paddingleft-2\">\n" +
                "   <li>\n" +
                "    <section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">\n" +
                "     内部库和外部库\n" +
                "    </section></li>\n" +
                "  </ul>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">共享库的另一个不同之处是，托管源码控制仓库的位置，不管是在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>实例内部还是在外部源码控制系统中。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">在大多数情况下内部被视为一种更偏向传统的选项，但出于完整性考虑，此处也包含了相关描述。</p>\n" +
                "  <h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;\"><span style=\"display: none;\"></span>2、需求引入</h2>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">本文标题提到的<strong>使(妙)用</strong>，就是指上面概念中提到的<strong>内部库</strong>，这个概念网上(千篇一律)很少能找到。是的，我这里将仔细分析出我的应用场景，以便于表达我的迫切需求(这也可能是很多共享库用户的需求)。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">在大多数共享库使用场景下，我们都是将共享库的代码提交到公共的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">git</code>仓库服务商，例如<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">github</code>、<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">gitee</code>，或者是提交到企业内部搭建的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">git</code>服务端，例如<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">gitlab</code>。为了能够正常使用这个外部的共享库，<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>与之的一大要求就是网络能够连通，保障能通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>或者<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">http</code>协议进行通信。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">但往往很多场景下，我们的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>不能连通外网，甚至连必须的插件也需要离线下载后安装或者临时通过网络代理安装。如果网络不能连通，是不是就意味着我们的共享库不能用了呢？一开始我也这样以为，想要用到共享库方法的解决办法(未必最佳)可能有如下</p>\n" +
                "  <ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;\" class=\"list-paddingleft-2\">\n" +
                "   <li>\n" +
                "    <section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">\n" +
                "     <p style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;\">方法一</p>\n" +
                "     <p style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;\">拆分共享库的方法，单独集成到<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>流水线脚本中，但这样会导致每个<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>的长度回归到使用共享库之前那样冗长和重复</p>\n" +
                "    </section></li>\n" +
                "   <li>\n" +
                "    <section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">\n" +
                "     <p style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;\">方法二</p>\n" +
                "     <p style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;color: black;\">再在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>所在的网络环境中搭建一个轻量的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">git</code>服务端，例如<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">git init</code>创建一个，但无法可视化，且不安全，存在于服务器的仅仅是一个目录</p>\n" +
                "    </section></li>\n" +
                "  </ul>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">以上方法虽然能实现我们想要使用共享库方法，但都不太友好。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">再来聊一下内部库，在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins 2.0</code>时代，包含着一个<strong>内部库</strong>，可用于存储内部库或测试目的。内部库默认有一个特定的名称<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>，这其实就是一个内置于<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>内部的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Git</code>仓库。那既然这个库内置了，存在于哪里呢？我们来看一下<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>的安装主目录，我这里的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>基于<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">k8s</code>安装，并且做了数据卷的持久化，进入对应的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pv</code>下查看，其中的主要目录如下所示</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\"><span style=\"color: #61aeee;line-height: 26px;\">$</span><span style=\"line-height: 26px;\">&nbsp;tree&nbsp;-L&nbsp;1&nbsp;kube-system-jenkins-data-pvc-6866fcaf-b742-40e0-afa8-64b93e75ef52</span>kube-system-jenkins-data-pvc-6866fcaf-b742-40e0-afa8-64b93e75ef52/├──&nbsp;backup├──&nbsp;jobs├──&nbsp;log├──&nbsp;logs├──&nbsp;nodes├──&nbsp;pipeline-config-history├──&nbsp;plugins├──&nbsp;secrets├──&nbsp;updates├──&nbsp;userContent├──&nbsp;users├──&nbsp;war├──&nbsp;workflow-libs&nbsp;&nbsp;#&nbsp;内部库└──&nbsp;workspace</code></pre>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">内部库名为<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflow-libs</code>，这个内部库其实就是一个已经初始化且存在于<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>内部的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Git</code>仓库。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">下面记录如何使用<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>内部库。</p>\n" +
                "  <h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;\"><span style=\"display: none;\"></span>3、开通workflowLibs</h2>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\"><code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>内部库和普通的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">git</code>仓库一样，可以通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>访问或<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">http</code>访问，本文记录的是通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>协议访问，另外一种方式类似。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">由于<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>部署在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">k8s</code>中，因此我们只能通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ingress</code>或者在内网环境下通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">nodePort</code>方式访问。在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">k8s</code>中部署的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>默认暴露的是<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">8080</code>端口，这个端口用于提供<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">http</code>访问。同时我这里使用到了基于<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">k8s</code>动态的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">slave</code>模式动态构建以及管理外部的普通<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">agent</code>，相互通信需要再打开一个端口，端口号可以在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>的系统配置—&gt;全局安全配置—&gt;代理中指定。</p>\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>3.1 开通ssh端口<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">这里需要再为<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>开放一个<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>协议的端口，用于共享库的开发者和<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>内部库通信，由于不想暴露给外部，我这里还是通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">nodePort</code>方式去访问，<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code> <code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Service</code>声明如下</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\"><span style=\"color: #d19a66;line-height: 26px;\">apiVersion:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">v1</span><span style=\"color: #d19a66;line-height: 26px;\">kind:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">Service</span><span style=\"color: #d19a66;line-height: 26px;\">metadata:</span>&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">name:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">jenkins</span>&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">namespace:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">kube-system</span><span style=\"color: #d19a66;line-height: 26px;\">spec:</span>&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">type:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">NodePort</span>&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">selector:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">name:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">jenkins</span>&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">ports:</span>&nbsp;&nbsp;<span style=\"color: #61aeee;line-height: 26px;\">-</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">name:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">http</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">port:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">targetPort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">8080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">protocol:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">TCP</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">nodePort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">30009</span>&nbsp;&nbsp;<span style=\"color: #61aeee;line-height: 26px;\">-</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">name:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">agent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">port:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">35555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">targetPort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">35555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">protocol:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">TCP</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">nodePort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">35555</span>&nbsp;&nbsp;<span style=\"color: #61aeee;line-height: 26px;\">-</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">name:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">jenkinsssh</span>&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">#&nbsp;Jenkins&nbsp;ssh</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">port:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">22222</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">targetPort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">22222</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">protocol:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">TCP</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">nodePort:</span>&nbsp;<span style=\"color: #d19a66;line-height: 26px;\">32222</span></code></pre>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">重新应用资源清单</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\"><span style=\"color: #61aeee;line-height: 26px;\">$</span><span style=\"line-height: 26px;\">&nbsp;kubectl&nbsp;apply&nbsp;-f&nbsp;jenkins-svc.yaml</span></code></pre>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">登录到<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>，系统配置—&gt;全局安全配置—&gt;<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">SSH Server</code>，设置<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>端口，这个端口与上面<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Service</code>中指定的端口对应</p>\n" +
                "  <img data-ratio=\"0.362962962962963\" data-src=\"https://file.codingstyle.cn/article/photo/2021/1.png\" src=\"https://file.codingstyle.cn/article/photo/2021/1.png?wx_fmt=png\" data-type=\"png\" data-w=\"1350\" style=\"display: block; margin-right: auto; margin-left: auto; zoom: 80%; width: 657px !important; height: 240.059px !important;\" _width=\"677px\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>3.2 配置密钥<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">http://&lt;jenkins-url&gt;/user/&lt;userid&gt;/configure</code>页面的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">SSH</code>公钥字段中添加用户的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">SSH</code>公钥，这个公钥在我们能够和<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins Server</code>进行<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>通信的机器上生成即可，生成后在当前用户的设置界面下进行添加</p>\n" +
                "  <img data-ratio=\"0.5678092399403875\" data-src=\"https://file.codingstyle.cn/article/photo/2021/1.png\" src=\"https://file.codingstyle.cn/article/photo/2021/1.png?wx_fmt=png\" data-type=\"png\" data-w=\"2684\" style=\"display: block; margin-right: auto; margin-left: auto; zoom: 67%; width: 657px !important; height: 374.341px !important;\" _width=\"677px\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>3.3 初始化克隆workflowLibs库<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">上面的操作完成后，就可以在共享库代码的开发机器(<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">ssh</code>客户端)上进行克隆了</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\">➜&nbsp;&nbsp;~&nbsp;git&nbsp;clone&nbsp;ssh://ssgeek@192.168.12.82:32222/workflowLibs.gitCloning&nbsp;into&nbsp;'workflowLibs'...warning:&nbsp;You&nbsp;appear&nbsp;to&nbsp;have&nbsp;cloned&nbsp;an&nbsp;empty&nbsp;repository.➜&nbsp;&nbsp;~&nbsp;cd&nbsp;workflowLibs➜&nbsp;&nbsp;workflowLibs&nbsp;git&nbsp;checkout&nbsp;-b&nbsp;masterSwitched&nbsp;to&nbsp;a&nbsp;new&nbsp;branch&nbsp;'master'</code></pre>\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>3.4 配置使用workflowLibs库<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">要提到的是，与配置其他的共享库不一样，内部库在使用前并不需要在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>上单独配置使用共享库<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>内部库，内部库只要提交代码，就能直接在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>中导入和使用。</p>\n" +
                "  <h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;\"><span style=\"display: none;\"></span>4、自定义使用workflowLibs库</h2>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">这里以我生产使用的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>库中的其中一个方法为例，即上线通知，我把它称为“上线小喇叭”。</p>\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>4.1 方法定义<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">使用这个功能时，我关注到<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>最新的钉钉插件已经更新，这次的上线通知借助了此插件，如果是不想通过插件，更为灵活的自定义钉钉通知，可以参考我之前的文章<a target=\"_blank\" href=\"http://mp.weixin.qq.com/s?__biz=MzkxNzAzNDA3Ng==&amp;mid=2247483946&amp;idx=1&amp;sn=c7ce84dcb7986bc982e06843720dde1b&amp;chksm=c1478719f6300e0fa6fbe7dec5e2f26903c28de668459fdff7a9e5cc87d504ec2fd2c459076b&amp;scene=21#wechat_redirect\" data-itemshowtype=\"0\" tab=\"innerlink\" style=\"letter-spacing: 0px;\" data-linktype=\"2\">Jenkins ShareLibrary实践之自定义通知器<span style=\"color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;text-align: left;\">。两种方式具体选择哪个，根据自己的需求合理定制即可。</span></a></p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">我把关于钉钉插件和共享库使用的方法命名为<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">dingtalk.groovy</code>，为了减少在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>中的引用操作，将这个文件放在了共享库目录的全局方法目录中，对<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>来说，直接调用。</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">整个<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>库的目录结构如下</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\">[root@dev&nbsp;workflowLibs]#&nbsp;tree&nbsp;-L&nbsp;2.├──&nbsp;README.md└──&nbsp;vars&nbsp;&nbsp;&nbsp;&nbsp;└──&nbsp;dingtalk.groovy1&nbsp;directory,&nbsp;2&nbsp;files</code></pre>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">方法如下，其中的消息内容需要按照插件说明编写固定的格式</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\"><span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">/*&nbsp;dingtalk.groovy&nbsp;&nbsp;&nbsp;##################################################&nbsp;&nbsp;&nbsp;#&nbsp;Created&nbsp;by&nbsp;SSgeek&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;#&nbsp;A&nbsp;Part&nbsp;of&nbsp;the&nbsp;Project&nbsp;jenkins&nbsp;workflowLibs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;#&nbsp;https://www.ssgeek.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;##################################################*/</span><span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;post步骤</span><span style=\"color: #c678dd;line-height: 26px;\">def</span>&nbsp;dingTalk(BasicEnv,ImageTag,ReleaseMess){&nbsp;&nbsp;&nbsp;&nbsp;wrap([<span style=\"color: #98c379;line-height: 26px;\">$class:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'BuildUser'</span>]){&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dingTalk&nbsp;(&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;机器人&nbsp;id</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;robot:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'eb5e68bb-1ad7-4638-8008-9d0d1072d319'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;消息类型</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'ACTION_CARD'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;需要&nbsp;@&nbsp;的手机号码</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at:</span>[],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;是否&nbsp;@&nbsp;全部</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;atAll:</span>&nbsp;<span style=\"color: #56b6c2;line-height: 26px;\">true</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;消息标题</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'生产上线小喇叭'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;消息内容主体</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text:</span>&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"[${env.JOB_NAME}](${env.JOB_URL})\\n\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'---'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;任务编号：[${env.BUILD_ID}](${env.BUILD_URL})\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;上线版本：**${ImageTag}**\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;上线环境：**${BasicEnv}**\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;\"-&nbsp;上线结果：**☆${currentBuild.currentResult}☆**\",</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;上线结果：**\uD83D\uDC49☆${currentBuild.currentResult}☆\uD83D\uDC48**\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;上线发起：**${env.BUILD_USER}**\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;上线描述：**${ReleaseMess}**\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"-&nbsp;持续时间：${currentBuild.durationString}\\n\"</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;点击消息跳转的&nbsp;URL</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageUrl:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">''</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;图片&nbsp;URL</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;picUrl:</span><span style=\"color: #98c379;line-height: 26px;\">''</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;单个按钮的方案，设置此项和&nbsp;singleUrl&nbsp;后&nbsp;btns&nbsp;无效</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;singleTitle:'',</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;singleUrl:'',</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;自定义按钮组</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btns:</span>&nbsp;[&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'发布日志'</span>,<span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actionUrl:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"${env.BUILD_URL}/console\"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;title:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'控制台'</span>,<span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;actionUrl:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">\"https://jenkins.ssgeek.com\"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;],&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;按钮的排列方式：horizotal水平排列H、vertical垂直排列V</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btnLayout:</span>&nbsp;<span style=\"color: #98c379;line-height: 26px;\">'H'</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style=\"color: #5c6370;font-style: italic;line-height: 26px;\">//&nbsp;是否隐藏发消息者头像</span><span style=\"color: #61aeee;line-height: 26px;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hideAvatar:</span>&nbsp;<span style=\"color: #56b6c2;line-height: 26px;\">true</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&nbsp;&nbsp;}}</code></pre>\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>4.2 插件配置<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">插件需要在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>中配置钉钉机器人的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">hook</code>地址，配置完成会生成一个<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">id</code>，和上面方法中的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">robot</code>对应</p>\n" +
                "  <img data-ratio=\"0.590531561461794\" data-src=\"https://file.codingstyle.cn/article/photo/2021/1.png\" src=\"https://file.codingstyle.cn/article/photo/2021/1.png?wx_fmt=png\" data-type=\"png\" data-w=\"2408\" style=\"display: block; margin-right: auto; margin-left: auto; zoom: 67%; width: 657px !important; height: 389.202px !important;\" _width=\"677px\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">\n" +
                "  <h3 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 20px;\"><span style=\"display: none;\"></span>4.3 使用<span style=\"display: none;\"></span></h3>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">在<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">pipeline</code>中使用，部分内容如下</p>\n" +
                "  <pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: block;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/Oy8CSKcrQ44Mbs2MZichqVn5wbPjPAQrdRQfeoBbqeXLRV4LfRP5UMTlLUNbTicCKDsINCNKHic3UUn1PK9TvN5HA/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(40, 44, 52);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #abb2bf;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #282c34;border-radius: 5px;\">post{&nbsp;&nbsp;always{&nbsp;&nbsp;&nbsp;&nbsp;script{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dingtalk.dingTalk(BasicEnv,ImageTag,ReleaseMess)&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;}}</code></pre>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">效果这里就不贴图啦，查看钉钉插件的文档即可。</p>\n" +
                "  <h2 data-tool=\"mdnice编辑器\" style=\"margin-top: 30px;margin-bottom: 15px;font-weight: bold;font-size: 22px;\"><span style=\"display: none;\"></span>5、总结</h2>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">本文通过<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">workflowLibs</code>库的灵活使用，实现了在无外网共享库环境下，独立的<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;color: rgb(30, 107, 184);background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;\">Jenkins</code>使用共享库的需求</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">希望能帮助到大家，See you ~</p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\"></p>\n" +
                "  <p data-tool=\"mdnice编辑器\" style=\"padding-top: 8px;padding-bottom: 8px;line-height: 26px;\">部分描述内容参考自官方文档</p>\n" +
                " </section>\n" +
                " <p></p> \n" +
                "</div>";
    }

    private String expectedJianshuContent() {
        return "<article class=\"_2rhmJa\">\n" +
                " <p>参数过多的方法，该如何改善？</p> \n" +
                " <br> \n" +
                " <div class=\"image-package\"> \n" +
                "  <div class=\"image-container\" style=\"max-width: 700px; max-height: 544px; background-color: transparent;\"> \n" +
                "   <div class=\"image-container-fill\" style=\"padding-bottom: 56.67%;\"></div> \n" +
                "   <div class=\"image-view\" data-width=\"960\" data-height=\"544\">\n" +
                "    <img src=\"https://file.codingstyle.cn/article/photo/2021/2453618-74d25308997ab385.png\" data-original-width=\"960\" data-original-height=\"544\" data-original-format=\"image/png\" data-original-filesize=\"761869\" data-image-index=\"0\" style=\"padding-bottom: 25px;cursor: zoom-in;\" class=\"\" src=\"https://file.codingstyle.cn/article/photo/2021/2453618-74d25308997ab385.png?imageMogr2/auto-orient/strip|imageView2/2/w/960/format/webp\">\n" +
                "   </div> \n" +
                "  </div> \n" +
                "   \n" +
                " </div> \n" +
                " <h3>问题</h3> \n" +
                " <p>按照《Clean Code》中的标准，方法参数超过3个就已经是“过多”了。<br> 参数多带来的问题：</p> \n" +
                " <ul> \n" +
                "  <li>首先是调用的地方难以理解，特别是多个参数是同一类型的时候。不仅调用时要小心对应每个参数的位置。在方法参数数目变动时，更有造成bug的隐患。</li> \n" +
                "  <li>过多的参数也体现出方法责任过多，可能缺乏内聚的问题。</li> \n" +
                " </ul> \n" +
                " <p>这个问题可以用简单的重构入手进行改进。</p> \n" +
                " <h3>示例代码</h3> \n" +
                " <p>下面示例的重构代码来源于<br> <a href=\"https://github.com/xpmatteo/birthday-greetings-kata\" target=\"_blank\" rel=\"nofollow\">https://github.com/xpmatteo/birthday-greetings-kata</a></p> \n" +
                " <div class=\"_2Uzcx_\">\n" +
                "  <button class=\"VJbwyy\" type=\"button\" aria-label=\"复制代码\"><i aria-label=\"icon: copy\" class=\"anticon anticon-copy\">\n" +
                "    <svg viewbox=\"64 64 896 896\" focusable=\"false\" class=\"\" data-icon=\"copy\" width=\"1em\" height=\"1em\" fill=\"currentColor\" aria-hidden=\"true\">\n" +
                "     <path d=\"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z\"></path>\n" +
                "    </svg></i></button>\n" +
                "  <pre class=\"line-numbers  language-java\"><code class=\"java  language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendGreetings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> fileName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">XDate</span> xDate<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> smtpHost<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> smtpPort<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ParseException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">AddressException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MessagingException</span> <span class=\"token punctuation\">{</span>\n" +
                "        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n" +
                "        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>employee<span class=\"token punctuation\">.</span><span class=\"token function\">isBirthday</span><span class=\"token punctuation\">(</span>xDate<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n" +
                "            <span class=\"token class-name\">String</span> recipient <span class=\"token operator\">=</span> employee<span class=\"token punctuation\">.</span><span class=\"token function\">getEmail</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "            <span class=\"token class-name\">String</span> body <span class=\"token operator\">=</span> <span class=\"token string\">\"Happy Birthday, dear %NAME%\"</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%NAME%\"</span><span class=\"token punctuation\">,</span> employee<span class=\"token punctuation\">.</span><span class=\"token function\">getFirstName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "            <span class=\"token class-name\">String</span> subject <span class=\"token operator\">=</span> <span class=\"token string\">\"Happy Birthday!\"</span><span class=\"token punctuation\">;</span>\n" +
                "            <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>smtpHost<span class=\"token punctuation\">,</span> smtpPort<span class=\"token punctuation\">,</span> <span class=\"token string\">\"sender@here.com\"</span><span class=\"token punctuation\">,</span> subject<span class=\"token punctuation\">,</span> body<span class=\"token punctuation\">,</span> recipient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "        <span class=\"token punctuation\">}</span>\n" +
                "    <span class=\"token punctuation\">}</span>\n" +
                "<span class=\"token punctuation\">}</span>\n" +
                "\n" +
                "<span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> smtpHost<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> smtpPort<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> sender<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> subject<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> body<span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> recipient<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">AddressException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MessagingException</span> <span class=\"token punctuation\">{</span>\n" +
                "    <span class=\"token comment\">// Create a mail session</span>\n" +
                "    java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span><span class=\"token class-name\">Properties</span> props <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> java<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span><span class=\"token class-name\">Properties</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    props<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mail.smtp.host\"</span><span class=\"token punctuation\">,</span> smtpHost<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    props<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mail.smtp.port\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span> <span class=\"token operator\">+</span> smtpPort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    <span class=\"token class-name\">Session</span> session <span class=\"token operator\">=</span> <span class=\"token class-name\">Session</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "\n" +
                "    <span class=\"token comment\">// Construct the message</span>\n" +
                "    <span class=\"token class-name\">Message</span> msg <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MimeMessage</span><span class=\"token punctuation\">(</span>session<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    msg<span class=\"token punctuation\">.</span><span class=\"token function\">setFrom</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">InternetAddress</span><span class=\"token punctuation\">(</span>sender<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    msg<span class=\"token punctuation\">.</span><span class=\"token function\">setRecipient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Message</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">RecipientType</span><span class=\"token punctuation\">.</span>TO<span class=\"token punctuation\">,</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InternetAddress</span><span class=\"token punctuation\">(</span>recipient<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    msg<span class=\"token punctuation\">.</span><span class=\"token function\">setSubject</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "    msg<span class=\"token punctuation\">.</span><span class=\"token function\">setText</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "\n" +
                "    <span class=\"token comment\">// Send the message</span>\n" +
                "    <span class=\"token class-name\">Transport</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n" +
                "<span class=\"token punctuation\">}</span>\n" +
                "<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n" +
                " </div> \n" +
                " <h3>参数对象 (Parameter Object)</h3> \n" +
                " <p>使用抽取参数对象的方式，可以把多个有关联的参数组成一个对象来传递。<br> 往往在采用了这个重构后，会浮现出原本代码中缺失的业务概念。<br> 这个重构也是消除“基本类型迷恋”坏味道的利器。<br> 过程演示如下：</p> \n" +
                " <div class=\"image-package\"> \n" +
                "  <div class=\"image-container\" style=\"max-width: 700px; max-height: 597px;\"> \n" +
                "   <div class=\"image-container-fill\" style=\"padding-bottom: 52.23%;\"></div> \n" +
                "   <div class=\"image-view\" data-width=\"1143\" data-height=\"597\">\n" +
                "    <img src=\"https://file.codingstyle.cn/article/photo/2021/2453618-88198485749b903a.gif\" data-original-width=\"1143\" data-original-height=\"597\" data-original-format=\"image/gif\" data-original-filesize=\"262276\" data-image-index=\"1\" style=\"padding-bottom: 25px;cursor: zoom-in;\" class=\"image-loading\">\n" +
                "   </div> \n" +
                "  </div> \n" +
                "   \n" +
                " </div> \n" +
                " <h3>用Builder代替构造器</h3> \n" +
                " <p>从上面的演示可以发现，多个参数从调用方法的地方转移到了产生参数对象的地方。<br> 采取用Builder代替构造器的重构方法，可以使代码的意图更为明确。</p> \n" +
                " <div class=\"image-package\"> \n" +
                "  <div class=\"image-container\" style=\"max-width: 700px; max-height: 597px;\"> \n" +
                "   <div class=\"image-container-fill\" style=\"padding-bottom: 52.23%;\"></div> \n" +
                "   <div class=\"image-view\" data-width=\"1143\" data-height=\"597\">\n" +
                "    <img src=\"https://file.codingstyle.cn/article/photo/2021/2453618-61cfcdb0a31d4d7a.gif\" data-original-width=\"1143\" data-original-height=\"597\" data-original-format=\"image/gif\" data-original-filesize=\"757830\" data-image-index=\"2\" style=\"padding-bottom: 25px;cursor: zoom-in;\" class=\"image-loading\">\n" +
                "   </div> \n" +
                "  </div> \n" +
                "   \n" +
                " </div> \n" +
                " <h3>方法对象 (Method Object)</h3> \n" +
                " <p>另一种思路是把使用过多参数的方法抽取成一个对象。<br> 采用这种方法，参数会成为对象的属性。<br> 演示如下：</p> \n" +
                " <div class=\"image-package\"> \n" +
                "  <div class=\"image-container\" style=\"max-width: 700px; max-height: 597px;\"> \n" +
                "   <div class=\"image-container-fill\" style=\"padding-bottom: 52.23%;\"></div> \n" +
                "   <div class=\"image-view\" data-width=\"1143\" data-height=\"597\">\n" +
                "    <img src=\"https://file.codingstyle.cn/article/photo/2021/2453618-663d4ffd6f69e21c.gif\" data-original-width=\"1143\" data-original-height=\"597\" data-original-format=\"image/gif\" data-original-filesize=\"1093704\" data-image-index=\"3\" style=\"padding-bottom: 25px;cursor: zoom-in;\" class=\"image-loading\">\n" +
                "   </div> \n" +
                "  </div> \n" +
                "   \n" +
                " </div> \n" +
                " <p>同样，也结合使用了Builder。</p> \n" +
                " <h3>结论</h3> \n" +
                " <ul> \n" +
                "  <li>参数对象可以把多个原始类型的参数合并为一个有业务意义的对象。</li> \n" +
                "  <li>方法对象可以把较为复杂的操作独立为单独的对象。原本的参数变为对象的状态。</li> \n" +
                "  <li>Builder模式可以有效改善构造器参数参数过多带来的问题。</li> \n" +
                " </ul> \n" +
                " <p>当然，以上仅仅是进行改进的开始。实际中往往会发现并非所有的参数都应该属于同一对象。也可能被重构的方法本身需要拆分成不同的部分。需要结合其它方法进行更深入的重构。</p> \n" +
                "</article>";
    }

}
